<!DOCTYPE html>
<html>
<head>
    <title>Cernak Lab - Isco Monitor</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; }
        #map { height: 100vh; width: 100%; background: #fff; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        var map = L.map('map', { crs: L.CRS.Simple, minZoom: -1 });
        var bounds = [[0,0], [1080,1920]];
        L.imageOverlay('Cernak lab map.svg', bounds).addTo(map);
        map.fitBounds(bounds);

        // 1. PASTE YOUR PUBLISHED CSV LINK HERE
        var sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQr85kdlDb92TZR_iUJTT3Plry6-0Bc4n3di7fTQvT1A6cMRcPcVe-TIA8WCqJRa15udjsAeG9jdoi0/pub?output=csv';

        // 2. PASTE YOUR REGULAR EDITABLE SHEET LINK HERE
        var editUrl = 'https://docs.google.com/spreadsheets/d/10DsQ---R2owVXBIlj2bMnjH3kB05bFl69PxMVVlC4dU/edit?gid=0#gid=0';

        function loadIscoStatus() {
            Papa.parse(sheetUrl, {
                download: true,
                header: true,
                complete: function(results) {
                    var iscoData = results.data.find(row => row.Instrument === 'Isco');
                    
                    if (iscoData) {
                        // Coordinates: Replace these with your clicked coordinates
                        var coords = [400, 300]; 
                        
                        var statusColor = iscoData.Status.toLowerCase();

                        L.circleMarker(coords, {
                            radius: 18,
                            fillColor: statusColor,
                            color: "#000",
                            weight: 3,
                            fillOpacity: 1
                        }).addTo(map).bindPopup(`
                            <div style="text-align: center; font-family: sans-serif;">
                                <h2 style="margin:0;">Isco</h2>
                                <p>Status: <b style="color: ${statusColor}; text-transform: uppercase;">${statusColor}</b></p>
                                <hr>
                                <a href="${editUrl}" target="_blank" style="display:inline-block; background:#000; color:#fff; padding:8px; text-decoration:none; border-radius:4px;">
                                    Change Status
                                </a>
                            </div>
                        `);
                    }
                }
            });
        }

        loadIscoStatus();
    </script>
</body>
</html>
