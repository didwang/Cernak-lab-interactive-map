<!DOCTYPE html>
<html>
<head>
    <title>Cernak Lab - Isco Portal</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        #map { height: 100vh; width: 100%; background: #f8f9fa; }
        
        /* Information Panel */
        .info-panel { line-height: 1.4; color: #212529; padding: 5px; }
        .status-badge { padding: 4px 12px; border-radius: 50px; color: white; font-weight: 800; font-size: 11px; letter-spacing: 0.5px; }
        
        /* High-Visibility Buttons */
        .btn { 
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px; 
            margin: 10px 0; 
            border-radius: 8px; 
            text-decoration: none !important; 
            color: #ffffff !important; /* Pure white text */
            font-weight: 700; 
            font-size: 13px;
            letter-spacing: 0.3px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
        }
        .btn:hover { filter: brightness(1.2); transform: translateY(-1px); }
        .btn-emoji { margin-right: 8px; font-size: 16px; }

        /* Deep, Saturated Colors for Maximum Contrast */
        .btn-manual  { background: #086d82; } /* Deep Teal */
        .btn-form    { background: #1e7e34; } /* Forest Green */
        .btn-history { background: #0056b3; } /* Royal Blue */
        .btn-status  { background: #343a40; } /* Charcoal Gray */
        .btn-ai      { background: #512da8; } /* Deep Indigo */
        
        hr { border: 0; border-top: 1px solid #dee2e6; margin: 15px 0; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        var map = L.map('map', { crs: L.CRS.Simple, minZoom: -1 });
        var bounds = [[0,0], [1080,1920]];
        L.imageOverlay('Cernak lab map.svg', bounds).addTo(map);
        map.fitBounds(bounds);

        var sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQr85kdlDb92TZR_iUJTT3Plry6-0Bc4n3di7fTQvT1A6cMRcPcVe-TIA8WCqJRa15udjsAeG9jdoi0/pub?output=csv';
        var formUrl  = 'https://docs.google.com/forms/d/e/1FAIpQLSfvjJTJ1nLW-Eb3ZoEL_wix3h7kMm0SoqeJ5ndFaYjvagW-_Q/viewform?usp=dialog';
        var logViewUrl = 'https://docs.google.com/spreadsheets/d/10DsQ---R2owVXBIlj2bMnjH3kB05bFl69PxMVVlC4dU/edit#gid=1956041763';
        var editUrl = 'https://docs.google.com/spreadsheets/d/10DsQ---R2owVXBIlj2bMnjH3kB05bFl69PxMVVlC4dU/edit#gid=0';
        var manualUrl = 'PASTE_YOUR_GITHUB_MANUAL_URL_HERE';

        // Pre-written AI Prompt
        var aiPrompt = encodeURIComponent("I am in the Cernak Lab troubleshooting our Isco Flash. I have the maintenance history logs and the manual. Based on current instrument status, what are the first three things I should check?");
        var aiLink = "https://gemini.google.com/app?prompt=" + aiPrompt;

        function loadIsco() {
            Papa.parse(sheetUrl, {
                download: true,
                header: true,
                complete: function(results) {
                    var isco = results.data.find(row => row.Instrument === 'Isco');
                    if (isco) {
                        var statusColor = isco.Status.trim().toLowerCase();
                        var steward = isco.Steward || "Unassigned";

                        // Using coordinates from your map (3606 location)
                        var marker = L.circle([400, 300], {
                            radius: 35, 
                            fillColor: statusColor,
                            color: "#000",
                            weight: 2.5,
                            fillOpacity: 1
                        }).addTo(map);

                        marker.bindPopup(`
                            <div class="info-panel" style="width: 260px;">
                                <h2 style="margin:0 0 10px 0; font-size: 22px; color: #000;">Isco Flash</h2>
                                <p style="margin:8px 0;"><b>STATUS:</b> <span class="status-badge" style="background:${statusColor}">${statusColor.toUpperCase()}</span></p>
                                <p style="margin:8px 0;"><b>STEWARD:</b> ${steward}</p>
                                <hr>
                                <a href="${manualUrl}" class="btn btn-manual" target="_blank"><span class="btn-emoji">ðŸ“–</span> VIEW MANUAL</a>
                                <a href="${formUrl}" class="btn btn-form" target="_blank"><span class="btn-emoji">âž•</span> ADD LOG ENTRY</a>
                                <a href="${logViewUrl}" class="btn btn-history" target="_blank"><span class="btn-emoji">ðŸ“œ</span> VIEW HISTORY</a>
                                <hr>
                                <a href="${editUrl}" class="btn btn-status" target="_blank">CHANGE RED/GREEN</a>
                                <a href="${aiLink}" class="btn btn-ai" target="_blank"><span class="btn-emoji">ðŸ¤–</span> ASK AI ASSISTANT</a>
                            </div>
                        `);
                    }
                }
            });
        }
        loadIsco();
    </script>
</body>
</html>
